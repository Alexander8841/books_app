<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Books App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .star {
            color: gold;
            font-size: 1rem;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="mb-4 text-center">üìö Books Library</h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
    <div class="row mb-4">
        <div class="col-md-6 mb-2">
            <input id="search" type="text" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É">
        </div>
        <div class="col-md-6 mb-2 d-flex gap-2">
            <select id="sort" class="form-select">
                <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å...</option>
                <option value="title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                <option value="rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–≤—ã—Å–æ–∫–∏–π ‚Üí –Ω–∏–∑–∫–∏–π)</option>
            </select>
            <button id="reset" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 g-4" id="books-list">
        {% for book in books %}
        <div class="col book-item" data-title="{{ book.title|lower }}" data-author="{{ book.author|lower }}" data-rating="{{ book.average_rating or 0 }}">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ book.title }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ book.author }}</h6>
                    <p>
                        –†–µ–π—Ç–∏–Ω–≥:
                        {% if book.average_rating %}
                            {% for i in range(book.average_rating|int) %}
                                <span class="star">‚òÖ</span>
                            {% endfor %}
                            {% for i in range(5 - book.average_rating|int) %}
                                <span class="star text-muted">‚òÜ</span>
                            {% endfor %}
                            <strong>{{ book.average_rating }}</strong>
                        {% else %}
                            –ù–µ—Ç –æ—Ü–µ–Ω–æ–∫
                        {% endif %}
                    </p>
                    <a href="{{ url_for('book_detail', book_id=book.id) }}" class="btn btn-primary">–û—Ç–∑—ã–≤—ã</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
const searchInput = document.getElementById("search");
const sortSelect = document.getElementById("sort");
const resetBtn = document.getElementById("reset");
const booksList = document.getElementById("books-list");
const books = Array.from(booksList.children);

// –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
function filterBooks() {
    const query = searchInput.value.toLowerCase();
    books.forEach(book => {
        const title = book.dataset.title;
        const author = book.dataset.author;
        book.style.display = (title.includes(query) || author.includes(query)) ? "" : "none";
    });
}

// –§—É–Ω–∫—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
function sortBooks() {
    const value = sortSelect.value;
    let sorted = [...books];
    if (value === "title") {
        sorted.sort((a, b) => a.dataset.title.localeCompare(b.dataset.title));
    } else if (value === "rating") {
        sorted.sort((a, b) => parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating));
    }
    sorted.forEach(book => booksList.appendChild(book));
}

searchInput.addEventListener("input", filterBooks);
sortSelect.addEventListener("change", sortBooks);
resetBtn.addEventListener("click", () => {
    searchInput.value = "";
    sortSelect.value = "";
    books.forEach(book => book.style.display = "");
    sortBooks();
});
</script>

</body>
</html>
